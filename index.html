<!doctype html>
<html>
<head>
  <title>Arogi Traveling Salesman</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
  <link rel="stylesheet" href="leaflet/leaflet.css" />
  <link rel="stylesheet" href="arogi_dark.css" />
  <script src="leaflet/leaflet.js"></script>
  <script src="https://mapzen.com/tangram/0.6/tangram.min.js"></script>
  <script src="ajax_functions.js"></script>
  <!-- // this loads a geojson of starting points.
  // the variable is called defaultMarkers -->
  <script src="data/tsp_data_SB14.js"></script>


  <style>

  body {
    padding: 0;
    margin: 0;
  }

  #map {
    height: 100%;
    width: 100%;
    padding:0px;
    margin:0px;
    position: absolute;
  }

  </style>
</head>

<body>
  <div id = "test_area">
    test area
  </div>

  <div id="map"></div>

  <script>

  $(document).ready(function() {

    circleArray = new Array();
    redDots = new Array();
    simpleCount = 0;
    var pointMarkers;
    problemState = 0;





    var useTheseMarkers = JSON.stringify(answeredGeoJson);

    $.ajax({
      type: 'POST',
      url: "interface/tsp_interface.py",  // deliver the data to this script... it will answer back with a solution
      data: {useTheseMarkers:useTheseMarkers},
      success: function(answerText)
      {
        // overwrites and displays existing answeredGeoJson...
        // with the response GeoJSON from the server
        //answeredGeoJson = JSON.parse(answerText);

        if (pointMarkers != undefined) {
                map.removeLayer(pointMarkers);
        }


        // to do: convert your response from the tsp interface from text into a json object
        answeredGeoJson = JSON.parse(answerText);
        //document.getElementById('test_area').innerHTML = answeredGeoJson.features;
        // to do: make myPointCoordinates into an array

        var myRouteCoordinates = new Array();
        var myLatCoords = new Array();
        myFriendlyGeoJsonObject = answeredGeoJson;

        someSortOfCounter = 0;
        //alert(someSortOfCounter);

        $.each(myFriendlyGeoJsonObject.features, function(i, v) {
          myRouteOrigin = v.geometry.coordinates;
          dest = v.properties.assignedTo;
          myRouteDest = myFriendlyGeoJsonObject.features[dest].geometry.coordinates;
          myLatCoords[0] = [myRouteOrigin[1],myRouteOrigin[0]];
          myLatCoords[1] = [myRouteDest[1],myRouteDest[0]];
          var polyline = L.polyline(myLatCoords, {color: 'red'}).addTo(map);

        });

        //alert(String(myFriendlyGeoJsonObject));

        myLatCoords[someSortOfCounter] = myLatCoords[0];
        //myRouteCoordinates.push = myRouteCoordinates[0];
        document.getElementById('test_area').innerHTML = JSON.stringify(myLatCoords);
        //var polyline = L.polyline(myLatCoords, {color: 'red'}).addTo(map);
      },

//        somesortofcounter = 0;
//        $.each(answeredGeoJson.features, function(i, v) {
//          myPointsCoordinates[somesortofcounter] = answerCoordinates = v.geometry.coordinates;
//          somesortofcounter++;
//        }

      error: function()
      {
        //// fail
      }

    });









  });

  // add basemap tiles from Mapzen's Tangram
  var map = L.map('map', {zoomControl: false});
  var layer = Tangram.leafletLayer({
    scene: 'grayprint.yaml',
    attribution: '<a href="arogi.com">Arogi</a> | &copy; <a href="http://osm.org">OpenSteetMap</a> | <a href="https://mapzen.com/tangram" target="_blank">Mapzen</a>'
  });
  layer.addTo(map);

  L.control.scale().setPosition('bottomright').addTo(map);
  new L.Control.Zoom({ position: 'bottomright' }).addTo(map);


  // this gets called on document.ready since the map needs a bounding area and
  // the initial ajax call might take a long time.
  //defaultMarkers is called from the data.js script.
  answeredGeoJson = defaultMarkers;
  //marker.bindPopup(popupContent).openPopup();
  var pointMarkers = L.geoJson(answeredGeoJson, {
    pointToLayer: function (feature, latlng) {
      var popupOptions = {maxWidth: 200};
      //var popupContent = "This is some content";
      return L.marker(latlng).bindPopup(String(latlng),popupOptions);
    }
  });
  // but the points do not need to be shown
  pointMarkers.addTo(map);

  map.fitBounds(pointMarkers, {padding:[140,140]});

  </script>

</body>

</html>
